---
title: "æ•°æ®æ•´ç†"
subtitle: "Learning R with Dr. Hu and His Friends"
author: "èƒ¡æ‚¦ï¼ˆæ¸…åå¤§å­¦æ”¿æ²»å­¦ç³»ï¼‰"
output: 
  learnr::tutorial:
    language: "zh"
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE,
                      out.width="100%")

if (!require(pacman)) install.packages("pacman")

p_load(drhur,
       here,
       rio,
       tidyverse)
```


## çŸ¥è¯†ç‚¹

- å•æ•°æ®æ•´ç†
    - æ¢ç´¢
    - æ¢³ç†
    - ç­›é€‰
    - ä¿®æ”¹
- è·¨æ•°æ®æ•´ç†
    - ç›´æ¥åˆå¹¶
    - ç´¢å¼•åˆå¹¶

## æ¼”ç¤ºæ•°æ®

![](images/wvs7.jfif){height=400}

æˆ‘ä»¬ä»å·²æ•…æ”¿æ²»å­¦æ•™æˆRonald Inglehartåˆ›ç«‹çš„[World Values Survey](https://www.worldvaluessurvey.org/wvs.jsp)ç¬¬ä¸ƒæ³¢æ•°æ®ï¼ˆWVS7ï¼‰çš„ä¸€ä¸ªæ ·æœ¬è¿›è¡Œæ¼”ç¤ºã€‚
è¿™ä¸ªæ ·æœ¬æ˜¯WVS7ä¸­2%çš„æ•°æ®ï¼ŒåŒ…å«24ä¸ªå˜é‡ã€‚
å…·ä½“å˜é‡ä¿¡æ¯å¯é€šè¿‡`?drhur::wvs7`æŸ¥çœ‹ã€‚

## æ•°æ®æ¢ç´¢

æ•°æ®æ¢ç´¢æŒ‡å¯¹é™Œç”Ÿæ•°æ®çš„æ•°æ®æ„æˆã€ç»“æ„ã€å½¢å¼ã€å†…å®¹çš„åˆæ­¥äº†è§£ï¼Œæ˜¯æ•°æ®åˆ†æçš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿæ˜¯å…³é”®ä¸€æ­¥ã€‚

### æ¦‚è§ˆåŸå§‹æ•°æ®

```{r glimpse, exercise = TRUE, exercise.eval = TRUE}
wvs7
```

- Tidy dataï¼ˆ`tibble`ï¼‰
    - è¡Œï¼šè§‚æµ‹å•å…ƒ
    - åˆ—ï¼šå˜é‡
    - å•å…ƒï¼šæ•°å€¼

### äº†è§£æ•°æ®ç»“æ„

- è§‚æµ‹é‡
- å˜é‡ååŠæ•°é‡
- æ•°æ®ç»“æ„

```{r systemView, exercise = TRUE}
wvs7
```

```{r systemView-solution}
nrow(wvs7) # è·å–æ•°æ®çš„è¡Œæ•°
ncol(wvs7) # è·å–æ•°æ®çš„åˆ—æ•°
names(wvs7) # è·å–å˜é‡å/åˆ—å
str(wvs7) # è·å–å˜é‡åã€å˜é‡åç±»å‹ã€è¡Œæ•°ã€åˆ—æ•°
```


### å˜é‡æå–

åŸºäºæ•°æ®è®¨è®ºå˜é‡ç‰¹å¾ï¼Œé¦–å…ˆè¦äº†è§£å¦‚ä½•è¡¨è¾¾æ•°æ®å’Œå˜é‡çš„ä»å±å…³ç³»ã€‚
åŒ…æ‹¬Råœ¨å†…çš„OOPç³»ç»Ÿéå¸¸æ“…é•¿å¤šæ•°æ®ã€å¤šå˜é‡çš„ååŒä½¿ç”¨å’Œåˆ†æã€‚
æ¢è¨€ä¹‹ï¼Œä¸ä¸€äº›å¸¸è§æ•°æ®åˆ†æè½¯ä»¶ä¸åŒï¼ŒRå¯ä»¥åŒæ—¶åŠ è½½å’Œç»¼åˆä½¿ç”¨å¤šä¸ªæ•°æ®â€”â€”åªè¦å°†ä»–ä»¬å­˜å…¥ä¸åŒçš„å¯¹è±¡å³å¯ã€‚

OOP &rarr; å¤šæ•°æ®åˆ†æ &rarr; æ•°æ®ä¿¡æ¯ + å˜é‡ä¿¡æ¯

```{r variable, exercise = TRUE}
wvs7[, "country"]
```

```{r variable-solution}
wvs7$country
```

### å˜é‡ç‰¹å¾

å˜é‡ä¿¡æ¯æå–ä¸ä¸Šä¸€èŠ‚ä¸­çš„å‘é‡ä¿¡æ¯æå–å®Œå…¨ä¸€è‡´ã€‚
æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡`table`å‘½ä»¤è·å¾—å˜é‡åˆ†å¸ƒï¼Œé€šè¿‡`summary`å‘½ä»¤è·å¾—å¸¸è§å˜é‡ä¿¡æ¯ã€‚
å½“ç„¶ï¼ŒRä¹Ÿæ”¯æŒè·å–å¹´é¾„å˜é‡çš„æ€»å’Œã€å¹³å‡æ•°ã€ä¸­ä½æ•°ã€æœ€å°å€¼ã€æœ€å¤§å€¼ã€æ–¹å·®ã€IQRç­‰ï¼Œè¿™äº›æ–¹æ³•æˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚ä»”ç»†è®¨è®ºã€‚

```{r varCal, exercise = TRUE}
table(wvs7$age)
summary(wvs7$age)
```

å¯¹äºéæ•°å€¼å‹å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ€»ç»“è¡¨çš„å½¢å¼è·å–ä»–ä»¬çš„ä¿¡æ¯

```{r varCat}
table(wvs7$female)
table(wvs7$marital)
```


å¯¹äºåŸºäºfactorçš„å˜é‡ï¼Œæˆ‘ä»¬è¿˜èƒ½æå–ä»–ä»¬çš„å±‚çº§ä¿¡æ¯

```{r varLevel}
levels(wvs7$religious)
levels(wvs7$marital)
```

### å˜é‡å±æ€§

å˜é‡å¯èƒ½ç”±äºå…¶ç±»ä¸åŒè€Œå…·æœ‰ä¸åŒçš„ç‰¹å¾ï¼Œæ¯”å¦‚å®šç±»å‘é‡å°±æ²¡æ³•æ±‚å¹³å‡å€¼ï¼Œå› æ­¤`mean`å¯¹äºä»–ä»¬å°±æ˜¯æ— æ„ä¹‰çš„ã€‚
ä½†æ‰€æœ‰å˜é‡éƒ½å…·æœ‰ä¸€äº›å±æ€§ç‰¹å¾ï¼Œæ¯”å¦‚å˜é‡çš„é•¿åº¦ã€ç±»åˆ«ã€ç‰¹å¾å€¼ç­‰ã€‚
è€Œå¯¹è¿™äº›ç‰¹å¾çš„æå–å‘½ä»¤ä¹Ÿæ˜¯å…±é€šçš„ã€‚

```{r varAttr}

```

```{r varAttr-solution}
length(wvs7$age) #æ±‚å–å¹´ä»½çš„é•¿åº¦ï¼ˆæ­¤å¤„ä¸ºè¡Œæ•°ï¼‰
unique(wvs7$age)

summary(wvs7$age) #è·å–å¹´ä»½çš„ä¸Šè¿°æ‰€æœ‰ä¿¡æ¯
class(wvs7$age) #æŸ¥çœ‹å¹´ä»½ç»“æ„ï¼švectorã€matrixã€arrayã€dataframeã€list
typeof(wvs7$age) #æŸ¥çœ‹å¹´ä»½å…ƒç´ ç±»å‹
```

### å˜é‡æ€»è§ˆ

```{r summary}
summary(wvs7$age)
summary(wvs7)
```


## æ•°æ®æ¢³ç†

å¦‚æœè¯´æ•°æ®æ¢ç´¢æ˜¯ä»æ•°æ®ä¸­çœ‹å˜é‡ï¼Œé‚£ä¹ˆæ•°æ®æ¢³ç†å°±æ˜¯ä»¥å˜é‡ä¸ºç´¢å¼•æ¥äº†è§£æ•°æ®ã€‚
ä»å®ç”¨è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥ä»‹ç»å¦‚ä½•ä½¿ç”¨`tidyverse`è¿›è¡Œæ•°æ®æ¢³ç†ã€‚
ä½†å…¶å®ç»å¤§éƒ¨åˆ†æ•°æ®æ¢³ç†éƒ½æ˜¯å¯ä»¥é€šè¿‡Rçš„è‡ªå¸¦è¯­å¥å®Œæˆçš„ã€‚
æˆ‘ä»¬ä¹Ÿå°†è‡ªå¸¦è¯­å¥å¯¹äºåŒä¸€ä»»åŠ¡çš„æ“ä½œæ”¾ç½®åœ¨â€œæç¤ºâ€å•å…ƒä¸­ã€‚

<!-- ç¿å“²ï¼Œè¯·ä½¿ç”¨RåŸºç¡€è¯­å¥å®Œæˆä»¥ä¸‹æ“ä½œï¼Œæ”¾ç½®åœ¨hintä¸­ã€‚ -->


### 

é¦–å…ˆä»‹ç»ä¸€ä¸‹`tidyverse`

+ æ˜¯ä¸€ä¸ªRåŒ…
+ æ˜¯ä¸€ç¾¤[RåŒ…](https://www.tidyverse.org/packages/)ï¼
+ åƒæ¼«å¨å’ŒDCæ¼«ç”»å®‡å®™ä¸€æ ·ï¼Œæ‰€æœ‰`tidyverse`ç»„æˆæˆå‘˜éƒ½åœ¨åŒä¸€ä¸ªæ•°æ®ç»“æ„å†…å·¥ä½œï¼Œå¯ä»¥ç›¸äº’å¯¹è¯ï¼Œå…±åŒä½¿ç”¨ã€‚

![](images/tidyverseHive.png){height=300}


### å®‰è£…

```{r loadTidy, eval=FALSE}
install.packages("tidyverse")
library("tidyverse")
```


### `dplyr`åŒ…

`tidyverse`ä¸­ä¸“é—¨è´Ÿè´£æ•°æ®æ¸…ç†çš„ç»„ä»¶ï¼Œè´¯å½»ä¸€ä¸ªå‡½æ•°åšä¸€ä»¶äº‹çš„é£æ ¼ã€‚

![](images/simple.png)
<!-- ç¿å“²ï¼Œè¯·åœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸­æ–‡cheatsheet,æˆªå›¾æ›¿æ¢ï¼Œå¹¶æ ‡æ˜å‡ºå¤„ -->

### é€šé“

åœ¨é€ä¸€ä»‹ç»`dplyr`çš„ä¸»è¦å‘½ä»¤å‰ï¼Œæˆ‘ä»¬è¦å…ˆè¯´æ˜ä¸€ä¸‹â€œé€šé“â€ï¼ˆpipeï¼‰ã€‚
é€šé“åœ¨Rä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨`|>`è¡¨ç¤ºï¼Œåœ¨å«èµ·`dplyr`åè¿˜å¯ä»¥ä½¿ç”¨åŠŸèƒ½æ›´å¼ºçš„`%>%`ã€‚
æˆ‘ä»¬åé¢çš„ä¾‹å­ç›´æ¥ä½¿ç”¨åè€…ã€‚
åœ¨Rä¸­ï¼Œé€šé“èµ·åˆ°è¿æ¥å¯¹äºåŒä¸€ä¸ªå¯¹è±¡çš„è¿ç»­åŠ¨ä½œï¼Œç›¸å½“äºåŠ¨ä½œæ¸¸æˆä¸­â€œæ“â€ä¸€ä¸ªè¿ç»­æŠ€ã€‚

![](images/comboAttack.gif){height=400}

###

å¦ä¸€æ–¹é¢ï¼Œé€šé“ä¹Ÿèƒ½è®©æ¯ä¸ªå‘½ä»¤æ’å¸ƒæ›´åŠ æ˜ç¡®ã€æ˜“è¯»ã€‚
å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ä»£ç æ¥æ¨¡æ‹Ÿç…®é¥ºå­çš„å…¨è¿‡ç¨‹ï¼Œå¤§ä½“æ˜¯è¿™æ ·ï¼š

```{r embeddedCode, eval=FALSE}
eat_dumpling <- 
eat(
  dip(
    cook(
      fill(
        mix(
          meat, 
          with = c(salt, soy_sauce, green_onion, ginger)
          ), 
        with = wrapper
        ), 
      in = boilled_water
      ), 
    in = vinegar)
  )
```

###

ä½¿ç”¨é€šé“åï¼Œå¯ä»¥å†™æˆè¿™æ ·

```{r pipeCode, eval=FALSE}
eat_dumpling <- 
mix(meat, with = c(salt, soy_sauce, green_onion, ginger)) %>% 
  fill(with = wrapper) %>% 
  cook(in = boilled_water) %>% 
  dip(in = vinegar) %>% 
  eat
```


`%>%`çš„å¿«æ·é”®:

* Ctrl + Shift + M (Win)
* Cmd + Shift + M (Mac)


### å˜é‡ç­›é€‰

`select(<data>, <var1>, <var2>, ...)`

ç°åœ¨æ•°æ®ä¸­æœ‰24ä¸ªå˜é‡ï¼Œæœ‰ä¸€äº›æœ‰æ„æ€çš„å˜é‡æ’åœ¨åé¢ä¸æ–¹ä¾¿çœ‹åˆ°ï¼Œæˆ‘ä»¬å¸Œæœ›çœ‹åˆ°ä¸€ä¸ªåªæœ‰å›½å®¶ã€å¹´é¾„ã€æ•™è‚²æ°´å¹³å’Œå¯¹æ”¿åºœä¿¡å¿ƒçš„æ•°æ®æ¡†ï¼š

```{r select, exercise=TRUE}
select(wvs7, country, age, education, confidence_gov)

# å¦‚æœæˆ‘ä»¬æƒ³çœ‹åˆ°å…³äºä¿¡å¿ƒçš„æ‰€æœ‰å˜é‡ï¼Œé™¤äº†é€ä¸ªåˆ—å‡ºæ¥ä»¥å¤–è¿˜èƒ½æ€ä¹ˆåšï¼Ÿ
```

```{r select-solution}
select(wvs7, country, age, education, starts_with("confidence"))
```

å’Œ`starts_with`ç±»ä¼¼çš„è¿˜æœ‰`ends_with`å’Œ`matches`ã€‚

> æç¤ºï¼šæ³¨æ„ç¬¬ä¸‰äººç§°å˜å•æ•°ğŸ˜

### 

åˆ é™¤å˜é‡å¯ä»¥é€šè¿‡`-`å®ç°ï¼š

```{r deselect}
select(wvs7, -(country:education))
```

###

ä¸€ä¸ª`select`è¡ç”Ÿä½“æ˜¯`rename`ï¼Œè¯­æ³•ä¸º`new.name = old.name`

```{r rename, exercise = TRUE}
rename(wvs7, nationality = country)
```


### æ•°æ®æ’åº

`arrange(<data>,...)`

æ¯”å¦‚æˆ‘ä»¬å¥½å¥‡æœ€å¹´è½»çš„äººç¾¤å¯¹å›½å®¶æœºå…³çš„ä¿¡å¿ƒï¼Œå¹¶å¯¹åº”ä»–ä»¬çš„æ•™è‚²æ°´å¹³ã€æ”¶å…¥æ°´å¹³ç­‰ä¿¡æ¯ã€‚

```{r arrange, exercise = TRUE}
select(wvs7, age, confidence_gov, education, incomeLevel)
```

```{r arrange-solution}
select(wvs7, age, confidence_gov, education, incomeLevel) %>% 
  arrange(age)
```

é‚£æœ€å¹´é•¿çš„é‚£ç¾¤äººå‘¢ï¼Ÿ

```{r arrangeDesc, exercise = TRUE}
select(wvs7, age, confidence_gov, education, incomeLevel) %>% 
  arrange(desc(age))

## å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“æœ€å¹´è½»åˆæ•™è‚²æœ€é«˜çš„äººå‘¢ï¼Ÿ
```

```{r arrangeDesc-solution}
select(wvs7, age, confidence_gov, education, incomeLevel) %>% 
  arrange(age, desc(education))
```

### å˜é‡å€¼ç­›é€‰

å‰é¢æåˆ°`select`æ˜¯å¯¹æ•°æ®åº“å˜é‡çš„ç­›é€‰ï¼Œ`filter`åˆ™åŸºäºå˜é‡å€¼çš„ç­›é€‰ã€‚
å»¶ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬å¥½å¥‡*ç¾å›½*æœ€å¹´è½»çš„ä¸€ç¾¤äººå¯¹å›½å®¶æœºå…³çš„ä¿¡å¿ƒä»¥åŠä»–ä»¬çš„æ•™è‚²æ°´å¹³å’Œæ”¶å…¥æ°´å¹³ã€‚

```{r filter, exercise=TRUE}
select(wvs7, age, confidence_gov, education, incomeLevel) %>% 
  arrange(age)
```


```{r filter-solution}
select(wvs7, age, confidence_gov, education, incomeLevel, country) %>% 
  filter(country == "United States") %>% 
  arrange(age)

select(wvs7, age, confidence_gov, education, incomeLevel, country) %>% 
  filter(country == "United States") %>% 
  filter(age == min(age, na.rm = TRUE))
```

### æ•°æ®ä¿®æ”¹

åœ¨æ•°æ®åˆ†æä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸è¦å°†æ•°æ®è¿›è¡Œè°ƒæ•´å’Œå†åŠ å·¥ï¼Œ`mutate`å¯ä»¥å¸®ä½ åšåˆ°è¿™ä¸€ç‚¹ã€‚
è‹±æ–‡ä¸­â€œmutateâ€è¡¨ç¤ºâ€œå˜å¼‚â€ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå‡½æ•°å¯ä»¥å®ç°çš„å¹¶ä¸æ˜¯æ— ä¸­ç”Ÿæœ‰ï¼Œè€Œæ˜¯æ”¹å¤´æ¢é¢ã€‚


###

å¦‚æœæˆ‘ä»¬å…³å¿ƒæ•™è‚²æ°´å¹³å¯¹æ”¶å…¥æ°´å¹³å·®å¼‚çš„å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªæ¯”ä¾‹å˜é‡

```{r mutate, exercise = TRUE}
mutate(wvs7, ratio_incomeEdu = incomeLevel / (education + 1)) %>%
  select(country, incomeLevel, education, ratio_incomeEdu) %>%
  arrange(desc(ratio_incomeEdu))

# å¦‚æœè¦æŠŠ`ratio_incomeEdu`å˜æˆä¸€ä¸ªç™¾åˆ†æ•°ï¼Œæ€ä¹ˆåŠï¼Ÿ
```

```{r mutate-solution}
mutate(wvs7, 
       ratio_incomeEdu = incomeLevel / (education + 1),
       ratio_incomeEdu = as.numeric(ratio_incomeEdu) %>%
         scales::percent()) %>%
  select(country, ratio_incomeEdu)
```


### 

`dplyr`è¿˜å…è®¸æ‰¹é‡ä¿®æ”¹

å¦‚ä½•å¯¹å˜é‡è¿›è¡Œæ‰¹é‡ä¿®æ”¹ï¼Ÿ`dplyr`å’Œå®ƒçš„æœ‹å‹`tidyselect`æä¾›äº†`across`å’Œ`where`å‡½æ•°ã€‚
æ¯”å¦‚å‡ºäºæŸç§éœ€è¦ï¼Œæˆ‘ä»¬è¦ç»™æ¯ä¸ªæ•°å­—å˜é‡éƒ½å–å¯¹æ•°ã€‚

> æµç¨‹ï¼š åˆ¤æ–­ &rarr; ç­›é€‰ &rarr; ä¿®æ”¹

```{r mutateBatch, exercise = TRUE}
wvs7 %>%
  mutate(across(where(is.numeric), log))

# æ˜¯å¦èƒ½ä½¿ç”¨è¿™å¥—æŠ€å·§å°†æ‰€æœ‰äººé™…ä¿¡ä»»å˜é‡éƒ½å€’å™ï¼Ÿ
```

```{r mutateBatch-solution}
wvs7 %>% 
  mutate(across(starts_with("trust"), ~ 5 - .))
```


### æ•°å€¼ç»Ÿè®¡

`count`ç”¨æ¥åŸºäºæ•°æ®è®¡æ•°ã€‚
æ¯”å¦‚ï¼Œå¯ä»¥ä½¿ç”¨countæ¥è®¡ç®—æˆ‘ä»¬çš„æ•°æ®ä¸­ç”·æ€§ã€å¥³æ€§å„æœ‰å¤šå°‘äººã€‚^[è¿™ç§åˆ—è¡¨åœ¨äººå£æ™®æŸ¥ç­‰ç»Ÿè®¡æ•°æ®ä¸­éå¸¸å¸¸è§ã€‚]

```{r count, exercise = TRUE}
wvs7 %>%
  count(female)

# å¦‚æœæƒ³çŸ¥é“ä¸åŒå¹´é¾„æ®µçš„ç”·å¥³æ•°é‡æ€ä¹ˆåŠå‘¢ï¼Ÿ
```

```{r count-solution}
wvs7 %>%
  count(age, female)
```


### 

`summarise` ç”¨æ¥å°†ä¸ªä½“æ•°æ®è½¬æ¢æˆç»Ÿè®¡æ•°æ®ã€‚
æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è·å¾—æ ·æœ¬çš„å¹´é¾„å’Œæ•™è‚²æ°´å¹³å¹³å‡æ•°


```{r summarise, exercise = TRUE}
wvs7 %>%
  summarise(age = mean(age, na.rm = TRUE),
            edu = mean(education, na.rm = TRUE))
```

### 

æˆ‘ä»¬å‰é¢æåˆ°çš„`across`, `start_with`ç­‰åŒæ ·å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ï¼š
æ¯”å¦‚æˆ‘ä»¬æƒ³è·å¾—æ‰€æœ‰å…³äºæœºæ„ä¿¡å¿ƒå˜é‡çš„å¹³å‡å€¼ï¼š

```{r summariseBatch, exercise = TRUE}
wvs7 %>%
  summarise(across(starts_with("confidence"), mean, na.rm = TRUE))
```

### 

`group_by`ä½¿åˆ†ç»„æ“ä½œæˆä¸ºå¯èƒ½ï¼š

```{r ex_summaryG, exercise = TRUE}
wvs7 %>%
  group_by(female) %>% 
  summarise(age = mean(age, na.rm = TRUE),
            edu = mean(education, na.rm = TRUE))
```

`group_by`å®é™…æ˜¯ä¸ºç°æœ‰æ•°æ®å»ºç«‹ç¾¤ä½“ç´¢å¼•ï¼Œä¹‹åçš„æ‰€æœ‰æ“ä½œéƒ½å°†åœ¨åˆ†ç»„è¿›è¡Œã€‚
è¿™ä¸€å‘½ä»¤çš„é€†æ“ä½œæ˜¯`ungroup`ã€‚


## Bonus

æ€ä¹ˆæ ·æ‰èƒ½å¡«è¡¥ç¼ºå¤±çš„ `x`, ç„¶åæŠŠ `y` å’Œ `z` åˆå¹¶æˆä¸€ä¸ªå˜é‡å‘¢?

```{r coalesce, exercise = TRUE}
df_toy <- data.frame(x = sample(c(1:2, NA, NA, NA)),
                     y = c(1, 2, NA, NA, 5),
                     z = c(NA, NA, 3, 4, 5))

df_toy
```


```{r coalesce-solution}
df_toy %>%
  mutate(x = coalesce(x, 0L),
         yz = coalesce(y, z)) # Ta-da~~~
```


## æ•°æ®æ•´ç†åŸåˆ™

æˆ‘ä»¬ä¸Šé¢çš„ä¸€ç³»åˆ—æ“ä½œéƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œä½ å‘ç°äº†å—ï¼Ÿ

```{r rawData}
head(wvs7)
```

- <span style="color:red">ä¸ç¢°</span>åŸå§‹æ•°æ®
- å¯¹è±¡è¦†ç›–éœ€è°¨æ…

```{r overwrite, exercise}
wvs7 <- mutate(wvs7, female = as.numeric(female))
```


## æ•°æ®æ•´åˆ
### ç›´æ¥åˆå¹¶

ç›´æ¥åˆå¹¶çš„å‰æåŸºæœ¬å’ŒçŸ©é˜µè¿ç®—æ˜¯åŸºæœ¬ä¸€è‡´çš„ï¼šåªæœ‰å‰åˆ—æ•°å¯¹å¾—ä¸Šåè¡Œæ‰èƒ½è¿›è¡Œã€‚

- è¡Œåˆå¹¶ï¼š åˆ—æ•°<span style="color:red">ç›¸ç­‰</span>(å¹¶ä¸æ˜¯~)
- åˆ—åˆå¹¶ï¼š è¡Œæ•°<span style="color:red">ç›¸ç­‰</span>

åˆ†åˆ«ä¸¾ä¸ªä¾‹å­ï¼š

```{r bindRow, exercise = TRUE}
wvs7_us <- filter(wvs7, country == "Unitied States")
wvs7_russia <- filter(wvs7, country == "Russia")

# åˆ›å»ºä¸€ä¸ªç¾ä¿„æ•°æ®

bind_rows(wvs7_us, wvs7_russia)

# ä¸ç­‰åˆ—è¡Œåˆå¹¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
```

```{r bindRow-hint}
# Try this
bind_rows(tibble(x = 1:3), tibble(y = 1:4))
```

```{r bindCol, exercise = TRUE}
wvs7_conf <- select(wvs7, starts_with("confidence"))
wvs7_trust <- select(wvs7, starts_with("trust"))

# åˆ›å»ºä¸€ä¸ªä¿¡å¿ƒ-ä¿¡ä»»æ•°æ®

bind_cols(wvs7_conf, wvs7_trust)
```


### ç´¢å¼•åˆå¹¶

ç´¢å¼•åˆå¹¶æŒ‡çš„æ˜¯åŸºäºå…±äº«çš„ç´¢å¼•åºåˆ—ï¼ˆå¯ä»¥æ˜¯ä»»ä½•å˜é‡ï¼‰åˆå¹¶æ•°æ®ã€‚

è®©æˆ‘ä»¬å…ˆåˆ›å»ºä¸¤ä¸ªæ¼”ç¤ºæ•°æ®:

1. ä¸ªä½“å±‚çº§å¹³ç­‰è®¤çŸ¥æ•°æ®ï¼›
1. å›½å®¶å±‚çº§äººå£å˜é‡æ•°æ®ã€‚

å¦‚æœ`wvs7_eq`æ˜¯è°ƒæŸ¥æ•°æ®ï¼Œ`wvs7_country`æ˜¯äººå£ç»Ÿè®¡æ•°æ®ï¼Œæˆ‘ä»¬çš„ç ”ç©¶éœ€è¦å°†è¿™ä¸¤ç»„æ•°æ®åˆå¹¶åˆ†æä¸ªä½“å±‚çº§å’Œå›½å®¶å±‚çº§å˜é‡é—´çš„å…³ç³»ã€‚

```{r join, exercise = TRUE}
wvs7_eq <- select(wvs7, country, starts_with("equal")) %>% 
  filter(country %in% unique(country)[1:2])

wvs7_country <- group_by(wvs7, country) %>% 
  summarise(across(female:education, mean, na.rm = TRUE)) %>% 
  ungroup %>% 
  filter(country %in% unique(country)[2:3])
```

```{r join-solution}
inner_join(wvs7_eq, wvs7_country)
left_join(wvs7_eq, wvs7_country)
right_join(wvs7_eq, wvs7_country)
full_join(wvs7_eq, wvs7_country)
```





## æ€»ç»“

1. è¡ŒåŠ¨<span style="color:red">ä¹‹å‰</span> æƒ³æ¸…æ¥š;
1. å·§å¦™ä¸”ç»¼åˆåœ°ä½¿ç”¨ `dplyr` å‡½æ•°;
    + æ¢ç´¢: `glimpse`, `head`, `tail`
        - ç»“æ„ï¼š`nrow`, `ncol`, `names`, `str`
        - ç‰¹å¾ï¼š`table`, `levels`
        - å±æ€§ï¼š`length`, `unique`, `summary`, `class`, `typeof`
    + æ¢³ç†: `dplyr`å‘½ä»¤é›†
1. æ•°æ®æ•´åˆåŸåˆ™ï¼šä¸ç¢°åŸæ•°æ®
1. æ•°æ®åˆå¹¶
    - ç›´æ¥åˆå¹¶ï¼š`bind_*`
    - ç´¢å¼•åˆå¹¶ï¼š`*_join`

